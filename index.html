<!DOCTYPE html> <html lang="zh-CN"> <head> <meta charset="UTF-8"> <title>Document</title> <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script> </head> <body> <div id="app"></div> <script>

function get(url, callback) {
  var xhr = new XMLHttpRequest()
  xhr.open('GET', url, true)
  xhr.onreadystatechange = function () {
    if (xhr.readyState === 4)
      if (xhr.status >= 200 && xhr.status < 300 || xhr.status == 304)
        callback(JSON.parse(xhr.responseText))
  }
  xhr.send()
}
function pGet(url) {
  return new Promise(function (resolve, reject) {
    get(url, function(data) {
      resolve(data)
    })
  })
}
function upload() {
  
}

function getQueryVariable(variable) {
  var query = window.location.search.substring(1);
  var vars = query.split("&");
  for (var i = 0; i < vars.length; i++) {
    var pair = vars[i].split("=");
    if (pair[0] == variable) { return pair[1]; }
  }
  return (false);
}

var app = new Vue({
  template:
  `<div>
    <div v-for="(item, index) in list">
      <a v-if="item.isDir" :href="'/web?path=' + path + item.name + '/'"> {{ item.name }} </a>
      <a v-if="item.isFile"> {{ item.name }} </a>
    </div>
  </div>`,
  el: '#app',
  data: {
    path: "",
    list: []
  },
  created() {
    this.path = getQueryVariable('path') || "/"
  },
  watch: {
    async path(val) {
      this.list = await pGet('/api/ls?path=' + val)
    }
  }
})
  </script> </body> </html>